# ProDvor API: Руководство для фронтенд-разработчика

Этот документ описывает ключевые аспекты взаимодействия с API ProDvor.

**Важно:** Единственным источником правды об API является спецификация `docs/OPENAPI_SPEC.json`. Этот документ лишь предоставляет удобный обзор и примеры.

---

## 1. Основы взаимодействия

-   **Базовый URL:** Адрес бэкенда хранится в переменной `NEXT_PUBLIC_API_BASE_URL`. Все эндпоинты, описанные в спецификации, доступны относительно этого URL.
-   **Авторизация:** Большинство эндпоинтов требуют аутентификации. Используется схема `Bearer Token`. Токен должен передаваться в заголовке `Authorization`.
-   **CORS:** Настроен на стороне бэкенда.
-   **API-клиент:** Для всех запросов используется автоматически сгенерированный клиент. Подробности по его обновлению см. в `docs/OPENAPI_SYNC.md`.

---

## 2. Стандартизированные ответы

### Пагинация

Все эндпоинты, возвращающие списки, поддерживают пагинацию через query-параметры `page` и `per_page`. Ответ имеет стандартизированную структуру:

```json
{
  "data": [ ... ],
  "meta": {
    "total": 100,
    "page": 1,
    "per_page": 20
  }
}
```

### Ошибки

Ошибки (статус `4xx` или `5xx`) возвращаются в стандартизированном формате:

```json
{
  "error": {
    "code": "unique_constraint_failed",
    "message": "Пользователь с таким email уже существует."
  }
}
```

---

## 3. Ключевые эндпоинты

Ниже приведены примеры основных эндпоинтов. Полный список и их схемы находятся в `docs/OPENAPI_SPEC.json`.

### 3.1. Аутентификация (`/auth`)

-   `POST /auth/login`: Вход пользователя. Возвращает `accessToken`, `refreshToken` и полный объект `user`.
-   `POST /auth/register`: Регистрация нового пользователя.
-   `POST /auth/refresh`: Обновление `accessToken` с помощью `refreshToken`.

### 3.2. Пользователи (`/users`)

-   `GET /users/me`: Получение данных текущего аутентифицированного пользователя.
-   `GET /users/{user_id}`: Получение публичных данных пользователя по его ID.
-   `GET /users/{user_id}/friends`: Получение списка друзей.
-   `GET /users/{user_id}/followers`: Получение списка подписчиков.
-   `GET /users/{user_id}/following`: Получение списка подписок.

### 3.3. Загрузка файлов (`/uploads`)

Используется двухшаговая система для загрузки аватаров, логотипов и других медиа.

1.  **`POST /uploads/initiate`**: Фронтенд запрашивает разрешение на загрузку, отправляя тип контента. Бэкенд возвращает presigned URL для прямой загрузки в S3-хранилище.
2.  **`POST /uploads/complete`**: После успешной загрузки файла, фронтенд уведомляет бэкенд, отправляя ID файла и ID сущности (пользователя или команды), с которой его нужно связать.

### 3.4. Управление сессиями (`/users/me/sessions`)

-   `GET /users/me/sessions`: Получение списка всех активных сессий пользователя.
-   `DELETE /users/me/sessions/{session_id}`: Завершение конкретной сессии.
-   `DELETE /users/me/sessions/all-except-current`: Завершение всех сессий, кроме текущей.

---

Полный и актуальный перечень всех доступных эндпоинтов и их моделей можно найти в файле `docs/OPENAPI_SPEC.json`.
